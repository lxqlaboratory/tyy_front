var n,e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}},o=/-(\w)/g,u=r((function(n){return n.replace(o,(function(n,e){return e?e.toUpperCase():""}))})),i=r((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;function c(n,r){if(t(n))return n;if(r&&(o=r,u=n,e.call(o,u)))return[n];var o,u,i=[];return n.replace(a,(function(n,e,t,r){return i.push(t?r.replace(/\\(\\)?/g,"$1"):e||n),r})),i}function s(n){return n.__wxWebviewId__?n.__wxWebviewId__:n.privateProperties?n.privateProperties.slaveId:n.$page?n.$page.id:void 0}function f(n){return n.route||n.uri}function p(n){return n.options||n.$page&&n.$page.options||{}}function l(n){return{id:s(n),path:f(n),query:p(n)}}function d(n){var e=function(n){return getCurrentPages().find((function(e){return s(e)===n}))}(n);return e&&e.$vm}function g(n,e){var t=d(n);return t&&function n(e,t){var r;return e&&(!function(n,e){return n.$scope&&((t=n.$scope).__wxExparserNodeId__||t.nodeId||t.id)===e;var t}(e,t)?e.$children.find((function(e){return r=n(e,t)})):r=e),r}(t,e)}function m(n,e){var t;return n&&(t=e?function(n,e){var t,r=c(e,n);for(t=r.shift();null!=t;){if(null==(n=n[t]))return;t=r.shift()}return n}(n.$data,e):Object.assign({},n.$data)),Promise.resolve({data:t})}function v(n,e){return n&&Object.keys(e).forEach((function(t){n[t]=e[t]})),Promise.resolve()}function h(e,t,r){return new Promise((function(o,u){if(!e)return u(n.VM_NOT_EXISTS);if(!e[t])return u(n.VM_NOT_EXISTS);var i,a=e[t].apply(e,r);!(i=a)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then?o({result:a}):a.then((function(n){o({result:n})}))}))}!function(n){n.VM_NOT_EXISTS="VM_NOT_EXISTS",n.METHOD_NOT_EXISTS="METHOD_NOT_EXISTS"}(n||(n={}));var _=/Sync$/;var y={getPageStack:function(){return Promise.resolve({pageStack:getCurrentPages().map((function(n){return l(n)}))})},getCurrentPage:function(){var n=getCurrentPages(),e=n.length;return new Promise((function(t,r){e?t(l(n[e-1])):r(Error("getCurrentPages().length=0"))}))},callUniMethod:function(n){var e=n.method,t=n.args;return new Promise((function(n,r){if(!uni[e])return r(Error("uni."+e+" not exists"));if(function(n){return _.test(n)}(e))return n({result:uni[e].apply(uni,t)});var o=[Object.assign({},t[0]||{},{success:function(t){setTimeout((function(){n({result:t})}),"pageScrollTo"===e?350:0)},fail:function(n){r(Error(n.errMsg.replace(e+":fail ","")))}})];uni[e].apply(uni,o)}))}},T={getData:function(n){return m(d(n.pageId),n.path)},setData:function(n){return v(d(n.pageId),n.data)},callMethod:function(e){var t,r=((t={})[n.VM_NOT_EXISTS]="Page["+e.pageId+"] not exists",t[n.METHOD_NOT_EXISTS]="page."+e.method+" not exists",t);return new Promise((function(n,t){h(d(e.pageId),e.method,e.args).then((function(e){return n(e)})).catch((function(n){t(Error(r[n]))}))}))}};function O(n){return n.nodeId||n.elementId}for(var S={getData:function(n){return m(g(n.pageId,O(n)),n.path)},setData:function(n){return v(g(n.pageId,O(n)),n.data)},callMethod:function(e){var t,r=O(e),o=((t={})[n.VM_NOT_EXISTS]="Component["+e.pageId+":"+r+"] not exists",t[n.METHOD_NOT_EXISTS]="component."+e.method+" not exists",t);return new Promise((function(n,t){h(g(e.pageId,r),e.method,e.args).then((function(e){return n(e)})).catch((function(n){t(Error(o[n]))}))}))}},E=("undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),[]),I=0;I<256;++I)E[I]=(I+256).toString(16).substr(1);["movable-view","picker","ad","button","checkbox-group","checkbox","form","icon","label","movable-area","navigator","picker-view-column","picker-view","progress","radio-group","radio","rich-text","u-slider","swiper-item","swiper","switch"].map((function(n){return i(u(n))}));var b={};Object.keys(y).forEach((function(n){b["App."+n]=y[n]})),Object.keys(T).forEach((function(n){b["Page."+n]=T[n]})),Object.keys(S).forEach((function(n){b["Element."+n]=S[n]}));var w,P=process.env.UNI_AUTOMATOR_WS_ENDPOINT;function $(n){w.send({data:JSON.stringify(n)})}function M(n){var e=JSON.parse(n.data),t=e.id,r=e.method,o=e.params,u={id:t},i=b[r];if(!i&&!i)return u.error={message:r+" unimplemented"},$(u);try{i(o).then((function(n){n&&(u.result=n)})).catch((function(n){u.error={message:n.message}})).finally((function(){$(u)}))}catch(n){u.error={message:n.message},$(u)}}swan.$$initRuntimeAutomator=function(n){void 0===n&&(n={}),(w=uni.connectSocket({url:P,complete:function(){}})).onMessage(M),w.onOpen((function(e){n.success&&n.success(),console.log("已开启自动化测试...")})),w.onError((function(n){console.log("automator.onError",n)})),w.onClose((function(){n.fail&&n.fail({errMsg:"$$initRuntimeAutomator:fail"}),console.log("automator.onClose")}))},setTimeout((function(){swan.$$initRuntimeAutomator()}),500);
